<div class="panel">
  <div class="row">
    <div class="large-12 columns" id="dashboard">
      <h1><%= @trip.name %></h1>
      <h4><%= @trip.description %></h4>
      <%= link_to "Refresh Feed", trip_update_feed_path(@trip.id), {class: "trip-update-feed-link"} %>
    </div>
  </div>
</div>

<div class="row" data-match-height>
  <div class="large-8 columns" data-height-watch>

    <div class="row panel">
      <div id="photos">
        <h5>Trip photos:</h5>
        <%= @photos.empty? ?  "There are no photos available." : render(@photos) %>
      </div>
    </div>
    <div class="row panel">
      <div id='map'>
        <h5>Trip checkins:</h5>
        <%= @checkins.empty? ? "There are no checkins available." : render(@checkins) %>
      </div>
    </div>

  </div> <!-- 8 column -->
  <div class="large-4 columns panel" data-height-watch>
    <div class="row">
        <div id="twitter-feed">
        <%= @statuses.empty? ? "There are no tweets available." : render(@statuses) %>
        </div>
      </div>
    </div>
  </div> <!-- 4 column -->

</div>

<div class="row">
  <div class="panel">
    <div class="row">
      <div class="large-12 columns tripsters" id="tripsters">
        <h5>Tripsters:</h5>
        <ul>
          <% @trip.active_users.each do |user| %>
          <li id="tripster_<%= user.id %>"><%= image_tag user.avatar_url %><%= button_to "-", :action => "destroy", :controller => "invite", :user_id => user.id%></li>
          <% end %>
        </ul>
        <%= link_to "Add Tripster", new_trip_invite_path(@trip.id), {class: "trip-invite-link"} %>
      </div>
    </div>
  </div>
</div>
<% unless @checkins.empty? %>
<script>
  var map = L.mapbox.map('map', 'rsoden.map-wjcj2udt');
    map.touchZoom.disable();
    map.doubleClickZoom.disable();
    map.scrollWheelZoom.disable();
    if (map.tap) map.tap.disable();
    map.markerLayer.on('click', function(e) {
          map.panTo(e.layer.getLatLng());
      });

  jQuery.getJSON('<%= @trip.id %>.json', function(checkinData){
    $.each(checkinData, function(index, checkin){
      
      var markerLayer = L.mapbox.markerLayer(checkin).addTo(map);
      markerLayer.eachLayer( function(checkin) {
      var content = '<h5>name: ' + checkin.feature.properties.name + '<\/h5>' +
        '<h6>address: ' + checkin.feature.properties.address + '<\/h6>' +
        '<h6>comment: ' + checkin.feature.properties.comment + '<\/h6>';
        checkin.bindPopup(content); 
      }); 
    });
  });
</script>
<% end %>
