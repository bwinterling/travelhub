<div class= "panel">
  <div class="row">
    <div class="large-9 columns" id= "dashboard">
      <h1><%= @trip.name %></h1>
      <h4><%= @trip.description %></h4>
      <%= link_to "Refresh Feed", trip_update_feed_path(@trip.id), {class: "trip-update-feed-link"} %>
    </div>
  </div>
</div>

<div class= "panel">
  
  <div class="row">
    <div class="large-9 columns" id="photos">
      <h5>Trip photos:</h5>
      <%= @photos.empty? ?  "There are no photos available." : render(@photos) %>
    </div>
  </div>


  <div class="row">
    <div class="large-9 columns" id="statuses">
      <h5>Trip tweets:</h5>
      <%= @statuses.empty? ? "There are no tweets available." : render(@statuses) %>
    </div>
  </div>
  
  <div class="row">
    <div class="large-12 columns" id='map'>
      <h5>Trip checkins:</h5>
      <%= @checkins.empty? ? "There are no checkins available." : render(@checkins) %>
    </div>
  </div>

  <div class="row">
    <div class="large-9 columns" id="tripsters">
      <h5>Tripsters:</h5>
      <% @trip.users.each do |user| %>
        <%= image_tag user.avatar_url %>
      <% end %>
      <%= link_to "Add Tripster", new_trip_invite_path(@trip.id), {class: "trip-invite-link"} %>
    </div>
  </div>
</div>

<% unless @checkins.empty? %>
<script>


  var map = L.mapbox.map('map', 'rsoden.map-wjcj2udt').setView([<%= @checkins.last.venue_latitude %>, <%= @checkins.last.venue_longitude %>], 13);
      map.touchZoom.disable();
      map.doubleClickZoom.disable();
      map.scrollWheelZoom.disable();
      if (map.tap) map.tap.disable();

L.control.layers({
      'Base Map': L.mapbox.tileLayer('rsoden.map-wjcj2udt').addTo(map),
      'Grey Map': L.mapbox.tileLayer('examples.map-20v6611k')
  }).addTo(map);

  markerLayer = jQuery.getJSON('<%= @trip.id %>.json', function(checkinData){
     $.each(checkinData, function(index, checkin){
        L.mapbox.markerLayer(checkin).eachLayer(function(marker) {
          var content = 
            '<h5>Name: ' + marker.feature.properties.name + '</h5>' +
            '<h6>Address: ' + marker.feature.properties.address + '</h6>' +
            '<h6>Comment: ' + marker.feature.properties.comment + '</h6>';
         marker.bindPopup(content).openPopup();
       });
       L.mapbox.markerLayer(checkin).addTo(map);
    });
  });

</script>
<% end %>

