<div class="row">
  <div class="large-9 columns" id= "dashboard">
    <div class= "panel">
    <h1><%= @trip.name %></h1>
    <%= @checkins.count %>
     <%= @checkins ? render(@checkins) : "There are no checkins available." %>
    </div>
  </div>
</div>
<hr>

<div class="row">
  <div class="large-9 columns" id="photos">
  <h5>Trip photos:</h5>
  <%= @photos ? render(@photos) : "There are no photos available." %>
  </div>
</div>


<div class="row">
  <div class="large-12 columns">
   <div id='map'></div>
   
  <div id="tweets">
    <h5>Trip tweets:</h5>
   <%= @statuses ? render(@statuses) : "There are no tweets available." %>
  </div>
</div>



<script>
var map = L.mapbox.map('map', 'rsoden.map-wjcj2udt')
      .setView([<%= @checkins.last.venue_latitude %>, <%= @checkins.last.venue_longitude %>], 13);

      // map.dragging.disable();
      map.touchZoom.disable();
      map.doubleClickZoom.disable();
      map.scrollWheelZoom.disable();
      // disable tap handler, if present.
      if (map.tap) map.tap.disable();


L.control.layers({
      'Base Map': L.mapbox.tileLayer('rsoden.map-wjcj2udt').addTo(map),
      'Grey Map': L.mapbox.tileLayer('examples.map-20v6611k')
  }).addTo(map);

var geoJson = {
        type: 'FeatureCollection',
        features: [{
            type: 'Feature',
            properties: {
                <% @checkins.map do |checkin| %>
                    name: '<%= checkin.venue_name %>',
                    'marker-color': '#ee7600',
                    'marker-size': 'medium',
                    address: '<%= checkin.venue_street_address %>',
                    comment: '<%= checkin.shout %>',
                    checkin_at: '<%= checkin.checkins_at %>'<% end %>
            },
          geometry: {
                type: 'Point',
                <% @checkins.map do |checkin| %>
                coordinates: [ <%= checkin.venue_longitude %>, <%= checkin.venue_latitude %>]
                <% end %>
            }
          }]
        };
    map.markerLayer.setGeoJSON(geoJson);
    map.markerLayer.on('click', function(e) {
    e.layer.unbindPopup();
    window.open(e.layer.feature.properties.url);
});

//   markerLayer.eachLayer(function(layer) {
//     var content = '<h1>name: ' + layer.feature.properties.name + '<\/h1>' +
//         '<h2>address: ' + layer.feature.properties.address + '<\/h2>' +
//         '<h2>comment: ' + layer.feature.properties.comment + '<\/h2>';
//     layer.bindPopup(content);
// });

</script>
